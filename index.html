<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realmzz - Ultimate Gaming Portal</title>
    <style>
        /* Styles remain unchanged, ensuring consistency */
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">Realmzz</div>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search games..." id="searchInput">
            <select class="filter-select" id="genreFilter">
                <option value="">All Genres</option>
                <option value="action">Action</option>
                <option value="adventure">Adventure</option>
                <option value="racing">Racing</option>
                <option value="sports">Sports</option>
                <option value="rpg">RPG</option>
            </select>
            <select class="filter-select" id="sortFilter">
                <option value="popularity">Most Popular</option>
                <option value="rating">Highest Rated</option>
                <option value="newest">Newest</option>
            </select>
        </div>
    </header>

    <div class="filter-container" id="filterTags"></div>
    <div class="games-grid" id="gamesGrid"></div>
    <div class="custom-frame-overlay" id="gameOverlay">
        <div class="custom-frame-container">
            <div class="custom-frame-header">
                <div class="frame-title" id="frameTitle"></div>
                <div class="frame-controls">
                    <button class="control-btn" id="refreshFrame">↻</button>
                    <button class="control-btn" id="closeFrame">×</button>
                </div>
            </div>
            <div id="frameSpinner" class="spinner"></div>
            <div id="gameContainer" class="custom-frame-content"></div>
        </div>
    </div>

    <script>
        class AdvancedGamePortal {
            constructor() {
                this.filters = { search: '', genre: '', sort: 'popularity' };
                this.activeGame = null;
                this.recommendations = [];
                this.analytics = {};
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.renderGames();
                this.setupCustomFrame();
            }

            setupEventListeners() {
                document.getElementById('searchInput').addEventListener('input', (e) => this.updateFilters({ search: e.target.value }));
                document.getElementById('genreFilter').addEventListener('change', (e) => this.updateFilters({ genre: e.target.value }));
                document.getElementById('sortFilter').addEventListener('change', (e) => this.updateFilters({ sort: e.target.value }));
                document.getElementById('closeFrame').addEventListener('click', () => this.closeGame());
                document.getElementById('refreshFrame').addEventListener('click', () => this.refreshGame());
            }

            updateFilters(newFilters) {
                this.filters = { ...this.filters, ...newFilters };
                this.renderGames();
                this.generateRecommendations();
            }

            setupCustomFrame() {
                this.overlay = document.getElementById('gameOverlay');
                this.frameContainer = document.getElementById('gameContainer');
                this.spinner = document.getElementById('frameSpinner');
                this.frameTitle = document.getElementById('frameTitle');
            }

            createGameCard(game) {
                const card = document.createElement('div');
                card.className = 'game-card';
                card.innerHTML = `
                    <img class="game-img" src="${game.thumbnail}" alt="${game.title}">
                    <div class="game-info">
                        <h3 class="game-title">${game.title}</h3>
                        <div class="game-genre">
                            <span class="tag">${game.genre}</span>
                        </div>
                        <div class="game-meta">
                            <span>Rating: ${game.rating}★</span>
                            <div class="popularity-meter">
                                <div class="popularity-fill" style="width:${game.popularity}%"></div>
                            </div>
                        </div>
                    </div>`;
                card.addEventListener('click', () => this.launchGame(game));
                return card;
            }

            filterAndSortGames() {
                let filtered = games.filter(game => {
                    const matchesSearch = game.title.toLowerCase().includes(this.filters.search.toLowerCase());
                    const matchesGenre = !this.filters.genre || game.genre === this.filters.genre;
                    return matchesSearch && matchesGenre;
                });
                filtered.sort((a, b) => {
                    switch (this.filters.sort) {
                        case 'rating':
                            return b.rating - a.rating;
                        case 'newest':
                            return new Date(b.releaseDate) - new Date(a.releaseDate);
                        default:
                            return b.popularity - a.popularity;
                    }
                });
                return filtered;
            }

            renderGames() {
                const grid = document.getElementById('gamesGrid');
                grid.innerHTML = '';
                const filteredGames = this.filterAndSortGames();
                filteredGames.forEach(game => grid.appendChild(this.createGameCard(game)));
            }

            async launchGame(game) {
                this.activeGame = game;
                this.recordAnalytics(game.id);
                this.overlay.classList.add('custom-frame-overlay-active');
                this.overlay.style.display = 'block';
                setTimeout(() => this.overlay.style.opacity = '1', 50);
                this.frameTitle.textContent = game.title;
                this.spinner.style.display = 'block';
                try {
                    await this.loadGameInFrame(game);
                } catch (error) {
                    console.error('Failed to load game:', error);
                } finally {
                    this.spinner.style.display = 'none';
                }
            }

            loadGameInFrame(game) {
                return new Promise((resolve, reject) => {
                    const iframe = document.createElement('iframe');
                    iframe.className = 'custom-frame-content';
                    iframe.src = game.url;
                    iframe.onload = () => {
                        this.frameContainer.innerHTML = '';
                        this.frameContainer.appendChild(iframe);
                        resolve();
                    };
                    iframe.onerror = reject;
                    setTimeout(resolve, 5000);
                });
            }

            refreshGame() {
                if (this.activeGame) {
                    this.frameContainer.innerHTML = '';
                    this.launchGame(this.activeGame);
                }
            }

            closeGame() {
                this.overlay.style.opacity = '0';
                setTimeout(() => {
                    this.overlay.style.display = 'none';
                    this.frameContainer.innerHTML = '';
                    this.activeGame = null;
                }, 300);
            }

            recordAnalytics(gameId) {
                if (!this.analytics[gameId]) {
                    this.analytics[gameId] = { views: 0, playtime: 0 };
                }
                this.analytics[gameId].views++;
                console.log(`Game ${gameId} has been viewed ${this.analytics[gameId].views} times.`);
            }

            generateRecommendations() {
                // Basic recommendation system logic
                console.log('Generating recommendations based on user filters and analytics...');
            }
        }

        document.addEventListener('DOMContentLoaded', () => new AdvancedGamePortal());
    </script>
</body>
</html>
